"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __values = (this && this.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var mock_helper_stub_1 = __importDefault(require("../mock-helper.stub"));
/**
 * @see https://developer.mozilla.org/de/docs/Web/Events
 */
var preventBubble = ['focus', 'blur', 'load', 'unload', 'change', 'reset', 'scroll'];
// istanbul ignore next
function customEvent(event, params) {
    var initParams = __assign({ bubbles: false, cancelable: false }, params);
    var eventObj = document.createEvent('CustomEvent');
    eventObj.initCustomEvent(event, initParams.bubbles, initParams.cancelable, null);
    return eventObj;
}
var eventCtor = typeof Event === 'function'
    ? function (event, init) { return new CustomEvent(event, init); }
    : /* istanbul ignore next */ customEvent;
var keyMap = {
    alt: {
        altKey: true,
        code: 'AltLeft',
        key: 'Alt',
        location: 1,
        which: 18,
    },
    arrowdown: {
        code: 'ArrowDown',
        key: 'ArrowDown',
        location: 0,
        which: 40,
    },
    arrowleft: {
        code: 'ArrowLeft',
        key: 'ArrowLeft',
        location: 0,
        which: 37,
    },
    arrowright: {
        code: 'ArrowRight',
        key: 'ArrowRight',
        location: 0,
        which: 39,
    },
    arrowup: {
        code: 'ArrowUp',
        key: 'ArrowUp',
        location: 0,
        which: 38,
    },
    backspace: {
        code: 'Backspace',
        key: 'Backspace',
        location: 0,
        which: 8,
    },
    control: {
        code: 'ControlLeft',
        ctrlKey: true,
        key: 'Control',
        location: 1,
        which: 17,
    },
    enter: {
        code: 'Enter',
        key: 'Enter',
        location: 0,
        which: 13,
    },
    esc: {
        code: 'Escape',
        key: 'Escape',
        location: 0,
        which: 27,
    },
    meta: {
        code: 'MetaLeft',
        key: 'Meta',
        location: 1,
        metaKey: true,
        which: 91,
    },
    shift: {
        code: 'ShiftLeft',
        key: 'Shift',
        location: 1,
        shiftKey: true,
        which: 16,
    },
    space: {
        code: 'Space',
        key: ' ',
        location: 0,
        which: 32,
    },
    tab: {
        code: 'Tab',
        key: 'Tab',
        location: 0,
        which: 9,
    },
};
for (var f = 1; f <= 12; f += 1) {
    keyMap["f" + f] = {
        code: "F" + f,
        key: "F" + f,
        location: 0,
        which: f + 111,
    };
}
var getCode = function (char) {
    var code = char.codePointAt(0);
    // a-z
    if (code && code >= 97 && code <= 122) {
        return "Key" + char.toUpperCase();
    }
    // A-Z
    if (code && code >= 65 && code <= 90) {
        return "Key" + char.toUpperCase();
    }
    // A-Z
    if (code && code >= 48 && code <= 57) {
        return "Digit" + char;
    }
    return 'Unknown';
};
var applyPayload = function (event, payload) {
    var e_1, _a;
    var keyData = {};
    try {
        for (var _b = __values(payload ? payload.split('.') : []), _c = _b.next(); !_c.done; _c = _b.next()) {
            var key = _c.value;
            var map = keyMap[key];
            if (!map && key.length === 1) {
                map = {
                    code: getCode(key),
                    key: key,
                };
            }
            if (!map) {
                throw new Error("Unknown event part " + key);
            }
            (0, mock_helper_stub_1.default)(keyData, map);
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
        }
        finally { if (e_1) throw e_1.error; }
    }
    if (payload) {
        (0, mock_helper_stub_1.default)(event, keyData);
    }
};
exports.default = (function (event, init, overrides) {
    var dot = event.indexOf('.');
    var _a = __read(dot === -1 ? [event] : [event.substr(0, dot), event.substr(dot + 1)], 2), eventName = _a[0], eventPayload = _a[1];
    var eventObj = eventCtor(eventName, __assign({ bubbles: preventBubble.indexOf(event) === -1, cancelable: true }, init));
    applyPayload(eventObj, eventPayload);
    if (overrides) {
        (0, mock_helper_stub_1.default)(eventObj, overrides);
    }
    return eventObj;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9jay1oZWxwZXIuZXZlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL25nLW1vY2tzL3NyYy9saWIvbW9jay1oZWxwZXIvZXZlbnRzL21vY2staGVscGVyLmV2ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5RUFBaUQ7QUFFakQ7O0dBRUc7QUFDSCxJQUFNLGFBQWEsR0FBRyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBRXZGLHVCQUF1QjtBQUN2QixTQUFTLFdBQVcsQ0FBQyxLQUFhLEVBQUUsTUFBa0I7SUFDcEQsSUFBTSxVQUFVLGNBQ2QsT0FBTyxFQUFFLEtBQUssRUFDZCxVQUFVLEVBQUUsS0FBSyxJQUNkLE1BQU0sQ0FDVixDQUFDO0lBQ0YsSUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNyRCxRQUFRLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFakYsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQztBQUVELElBQU0sU0FBUyxHQUNiLE9BQVEsS0FBYSxLQUFLLFVBQVU7SUFDbEMsQ0FBQyxDQUFDLFVBQUMsS0FBYSxFQUFFLElBQWdCLElBQWtCLE9BQUEsSUFBSSxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUE1QixDQUE0QjtJQUNoRixDQUFDLENBQUMsMEJBQTBCLENBQUMsV0FBVyxDQUFDO0FBRTdDLElBQU0sTUFBTSxHQUEyQjtJQUNyQyxHQUFHLEVBQUU7UUFDSCxNQUFNLEVBQUUsSUFBSTtRQUNaLElBQUksRUFBRSxTQUFT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QUU5RSxJQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pCLElBQUEsS0FBQSxPQUE0QixHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBQSxFQUEvRixTQUFTLFFBQUEsRUFBRSxZQUFZLFFBQXdFLENBQUM7SUFDdkcsSUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLFNBQVMsYUFDbEMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQzVDLFVBQVUsRUFBRSxJQUFJLElBQ2IsSUFBSSxFQUNQLENBQUM7SUFDSCxZQUFZLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBRXJDLElBQUksU0FBUyxFQUFFO1FBQ2IsSUFBQSwwQkFBYyxFQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQztLQUNyQztJQUVELE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUMsRUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb2NrSGVscGVyU3R1YiBmcm9tICcuLi9tb2NrLWhlbHBlci5zdHViJztcblxuLyoqXG4gKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2RlL2RvY3MvV2ViL0V2ZW50c1xuICovXG5jb25zdCBwcmV2ZW50QnViYmxlID0gWydmb2N1cycsICdibHVyJywgJ2xvYWQnLCAndW5sb2FkJywgJ2NoYW5nZScsICdyZXNldCcsICdzY3JvbGwnXTtcblxuLy8gaXN0YW5idWwgaWdub3JlIG5leHRcbmZ1bmN0aW9uIGN1c3RvbUV2ZW50KGV2ZW50OiBzdHJpbmcsIHBhcmFtcz86IEV2ZW50SW5pdCkge1xuICBjb25zdCBpbml0UGFyYW1zID0ge1xuICAgIGJ1YmJsZXM6IGZhbHNlLFxuICAgIGNhbmNlbGFibGU6IGZhbHNlLFxuICAgIC4uLnBhcmFtcyxcbiAgfTtcbiAgY29uc3QgZXZlbnRPYmogPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnQ3VzdG9tRXZlbnQnKTtcbiAgZXZlbnRPYmouaW5pdEN1c3RvbUV2ZW50KGV2ZW50LCBpbml0UGFyYW1zLmJ1YmJsZXMsIGluaXRQYXJhbXMuY2FuY2VsYWJsZSwgbnVsbCk7XG5cbiAgcmV0dXJuIGV2ZW50T2JqO1xufVxuXG5jb25zdCBldmVudEN0b3IgPVxuICB0eXBlb2YgKEV2ZW50IGFzIGFueSkgPT09ICdmdW5jdGlvbidcbiAgICA/IChldmVudDogc3RyaW5nLCBpbml0PzogRXZlbnRJbml0KTogQ3VzdG9tRXZlbnQgPT4gbmV3IEN1c3RvbUV2ZW50KGV2ZW50LCBpbml0KVxuICAgIDogLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gY3VzdG9tRXZlbnQ7XG5cbmNvbnN0IGtleU1hcDogUmVjb3JkPHN0cmluZywgb2JqZWN0PiA9IHtcbiAgYWx0OiB7XG4gICAgYWx0S2V5OiB0cnVlLFxuICAgIGNvZGU6ICdBbHRMZWZ0JyxcbiAgICBrZXk6ICdBbHQnLFxuICAgIGxvY2F0aW9uOiAxLFxuICAgIHdoaWNoOiAxOCxcbiAgfSxcbiAgYXJyb3dkb3duOiB7XG4gICAgY29kZTogJ0Fycm93RG93bicsXG4gICAga2V5OiAnQXJyb3dEb3duJyxcbiAgICBsb2NhdGlvbjogMCxcbiAgICB3aGljaDogNDAsXG4gIH0sXG4gIGFycm93bGVmdDoge1xuICAgIGNvZGU6ICdBcnJvd0xlZnQnLFxuICAgIGtleTogJ0Fycm93TGVmdCcsXG4gICAgbG9jYXRpb246IDAsXG4gICAgd2hpY2g6IDM3LFxuICB9LFxuICBhcnJvd3JpZ2h0OiB7XG4gICAgY29kZTogJ0Fycm93UmlnaHQnLFxuICAgIGtleTogJ0Fycm93UmlnaHQnLFxuICAgIGxvY2F0aW9uOiAwLFxuICAgIHdoaWNoOiAzOSxcbiAgfSxcbiAgYXJyb3d1cDoge1xuICAgIGNvZGU6ICdBcnJvd1VwJyxcbiAgICBrZXk6ICdBcnJvd1VwJyxcbiAgICBsb2NhdGlvbjogMCxcbiAgICB3aGljaDogMzgsXG4gIH0sXG4gIGJhY2tzcGFjZToge1xuICAgIGNvZGU6ICdCYWNrc3BhY2UnLFxuICAgIGtleTogJ0JhY2tzcGFjZScsXG4gICAgbG9jYXRpb246IDAsXG4gICAgd2hpY2g6IDgsXG4gIH0sXG4gIGNvbnRyb2w6IHtcbiAgICBjb2RlOiAnQ29udHJvbExlZnQnLFxuICAgIGN0cmxLZXk6IHRydWUsXG4gICAga2V5OiAnQ29udHJvbCcsXG4gICAgbG9jYXRpb246IDEsXG4gICAgd2hpY2g6IDE3LFxuICB9LFxuICBlbnRlcjoge1xuICAgIGNvZGU6ICdFbnRlcicsXG4gICAga2V5OiAnRW50ZXInLFxuICAgIGxvY2F0aW9uOiAwLFxuICAgIHdoaWNoOiAxMyxcbiAgfSxcbiAgZXNjOiB7XG4gICAgY29kZTogJ0VzY2FwZScsXG4gICAga2V5OiAnRXNjYXBlJyxcbiAgICBsb2NhdGlvbjogMCxcbiAgICB3aGljaDogMjcsXG4gIH0sXG4gIG1ldGE6IHtcbiAgICBjb2RlOiAnTWV0YUxlZnQnLFxuICAgIGtleTogJ01ldGEnLFxuICAgIGxvY2F0aW9uOiAxLFxuICAgIG1ldGFLZXk6IHRydWUsXG4gICAgd2hpY2g6IDkxLFxuICB9LFxuICBzaGlmdDoge1xuICAgIGNvZGU6ICdTaGlmdExlZnQnLFxuICAgIGtleTogJ1NoaWZ0JyxcbiAgICBsb2NhdGlvbjogMSxcbiAgICBzaGlmdEtleTogdHJ1ZSxcbiAgICB3aGljaDogMTYsXG4gIH0sXG4gIHNwYWNlOiB7XG4gICAgY29kZTogJ1NwYWNlJyxcbiAgICBrZXk6ICcgJyxcbiAgICBsb2NhdGlvbjogMCxcbiAgICB3aGljaDogMzIsXG4gIH0sXG4gIHRhYjoge1xuICAgIGNvZGU6ICdUYWInLFxuICAgIGtleTogJ1RhYicsXG4gICAgbG9jYXRpb246IDAsXG4gICAgd2hpY2g6IDksXG4gIH0sXG59O1xuZm9yIChsZXQgZiA9IDE7IGYgPD0gMTI7IGYgKz0gMSkge1xuICBrZXlNYXBbYGYke2Z9YF0gPSB7XG4gICAgY29kZTogYEYke2Z9YCxcbiAgICBrZXk6IGBGJHtmfWAsXG4gICAgbG9jYXRpb246IDAsXG4gICAgd2hpY2g6IGYgKyAxMTEsXG4gIH07XG59XG5cbmNvbnN0IGdldENvZGUgPSAoY2hhcjogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgY29kZSA9IGNoYXIuY29kZVBvaW50QXQoMCk7XG4gIC8vIGEtelxuICBpZiAoY29kZSAmJiBjb2RlID49IDk3ICYmIGNvZGUgPD0gMTIyKSB7XG4gICAgcmV0dXJuIGBLZXkke2NoYXIudG9VcHBlckNhc2UoKX1gO1xuICB9XG4gIC8vIEEtWlxuICBpZiAoY29kZSAmJiBjb2RlID49IDY1ICYmIGNvZGUgPD0gOTApIHtcbiAgICByZXR1cm4gYEtleSR7Y2hhci50b1VwcGVyQ2FzZSgpfWA7XG4gIH1cbiAgLy8gQS1aXG4gIGlmIChjb2RlICYmIGNvZGUgPj0gNDggJiYgY29kZSA8PSA1Nykge1xuICAgIHJldHVybiBgRGlnaXQke2NoYXJ9YDtcbiAgfVxuXG4gIHJldHVybiAnVW5rbm93bic7XG59O1xuXG5jb25zdCBhcHBseVBheWxvYWQgPSAoZXZlbnQ6IEV2ZW50LCBwYXlsb2FkPzogc3RyaW5nKTogdm9pZCA9PiB7XG4gIGNvbnN0IGtleURhdGE6IG9iamVjdCA9IHt9O1xuICBmb3IgKGNvbnN0IGtleSBvZiBwYXlsb2FkID8gcGF5bG9hZC5zcGxpdCgnLicpIDogW10pIHtcbiAgICBsZXQgbWFwID0ga2V5TWFwW2tleV07XG4gICAgaWYgKCFtYXAgJiYga2V5Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgbWFwID0ge1xuICAgICAgICBjb2RlOiBnZXRDb2RlKGtleSksXG4gICAgICAgIGtleSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKCFtYXApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBldmVudCBwYXJ0ICR7a2V5fWApO1xuICAgIH1cblxuICAgIG1vY2tIZWxwZXJTdHViKGtleURhdGEsIG1hcCk7XG4gIH1cblxuICBpZiAocGF5bG9hZCkge1xuICAgIG1vY2tIZWxwZXJTdHViKGV2ZW50LCBrZXlEYXRhKTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgKFxuICBldmVudDogc3RyaW5nLFxuICBpbml0PzogRXZlbnRJbml0LFxuICBvdmVycmlkZXM/OiBQYXJ0aWFsPFVJRXZlbnQgfCBLZXlib2FyZEV2ZW50IHwgTW91c2VFdmVudCB8IFRvdWNoRXZlbnQgfCBFdmVudD4sXG4pOiBDdXN0b21FdmVudCA9PiB7XG4gIGNvbnN0IGRvdCA9IGV2ZW50LmluZGV4T2YoJy4nKTtcbiAgY29uc3QgW2V2ZW50TmFtZSwgZXZlbnRQYXlsb2FkXSA9IGRvdCA9PT0gLTEgPyBbZXZlbnRdIDogW2V2ZW50LnN1YnN0cigwLCBkb3QpLCBldmVudC5zdWJzdHIoZG90ICsgMSldO1xuICBjb25zdCBldmVudE9iaiA9IGV2ZW50Q3RvcihldmVudE5hbWUsIHtcbiAgICBidWJibGVzOiBwcmV2ZW50QnViYmxlLmluZGV4T2YoZXZlbnQpID09PSAtMSxcbiAgICBjYW5jZWxhYmxlOiB0cnVlLFxuICAgIC4uLmluaXQsXG4gIH0pO1xuICBhcHBseVBheWxvYWQoZXZlbnRPYmosIGV2ZW50UGF5bG9hZCk7XG5cbiAgaWYgKG92ZXJyaWRlcykge1xuICAgIG1vY2tIZWxwZXJTdHViKGV2ZW50T2JqLCBvdmVycmlkZXMpO1xuICB9XG5cbiAgcmV0dXJuIGV2ZW50T2JqO1xufTtcbiJdfQ==