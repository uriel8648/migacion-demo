"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MockDirective = exports.MockDirectives = void 0;
var core_1 = require("@angular/core");
var testing_1 = require("@angular/core/testing");
var core_define_property_1 = __importDefault(require("../common/core.define-property"));
var core_form_1 = __importDefault(require("../common/core.form"));
var core_helpers_1 = require("../common/core.helpers");
var core_reflect_directive_resolve_1 = __importDefault(require("../common/core.reflect.directive-resolve"));
var func_get_mocked_ng_def_of_1 = require("../common/func.get-mocked-ng-def-of");
var func_import_exists_1 = __importDefault(require("../common/func.import-exists"));
var func_is_mock_ng_def_1 = require("../common/func.is-mock-ng-def");
var mock_control_value_accessor_1 = require("../common/mock-control-value-accessor");
var ng_mocks_universe_1 = __importDefault(require("../common/ng-mocks-universe"));
var decorate_declaration_1 = __importDefault(require("../mock/decorate-declaration"));
var DirectiveMockBase = /** @class */ (function (_super) {
    __extends(DirectiveMockBase, _super);
    // istanbul ignore next
    function DirectiveMockBase(injector, ngControl, // NgControl
    cdr, vcr, element, template) {
        if (element === void 0) { element = null; }
        if (template === void 0) { template = null; }
        var _this = _super.call(this, injector, ngControl) || this;
        _this.__ngMocksInstall(vcr, cdr, element, template);
        return _this;
    }
    DirectiveMockBase.prototype.ngOnInit = function () {
        var config = this.__ngMocksConfig.config;
        if (config === null || config === void 0 ? void 0 : config.render) {
            var _a = config.render !== true
                ? config.render
                : {
                    $implicit: undefined,
                    variables: {},
                }, $implicit = _a.$implicit, variables = _a.variables;
            this.__render($implicit, variables);
        }
    };
    DirectiveMockBase.prototype.__ngMocksInstall = function (vcr, cdr, element, template) {
        // Basically any directive on ng-template is treated as structural, even it does not control render process.
        // In our case we do not if we should render it or not and due to this we do nothing.
        (0, core_define_property_1.default)(this, '__element', element);
        (0, core_define_property_1.default)(this, '__template', template);
        (0, core_define_property_1.default)(this, '__viewContainer', vcr);
        (0, core_define_property_1.default)(this, '__vcr', vcr);
        (0, core_define_property_1.default)(this, '__cdr', cdr);
        (0, core_define_property_1.default)(this, '__isStructural', template && vcr);
        // Providing method to render mock values.
        (0, core_define_property_1.default)(this, '__render', function ($implicit, variables) {
            if (vcr && template) {
                vcr.clear();
                vcr.createEmbeddedView(template, __assign(__assign({}, variables), { $implicit: $implicit }));
                cdr.detectChanges();
            }
        });
    };
    return DirectiveMockBase;
}(mock_control_value_accessor_1.LegacyControlValueAccessor));
(0, core_define_property_1.default)(DirectiveMockBase, 'parameters', [
    [core_1.Injector],
    [core_form_1.default.NgControl || /* istanbul ignore next */ (function () { return undefined; }), new core_1.Optional(), new core_1.Self()],
    [core_1.ChangeDetectorRef],
    [core_1.ViewContainerRef],
    [core_1.ElementRef, new core_1.Optional(), new core_1.Self()],
    [core_1.TemplateRef, new core_1.Optional(), new core_1.Self()],
]);
var decorateClass = function (directive, mock) {
    var meta = (0, core_reflect_directive_resolve_1.default)(directive);
    var selector = meta.selector, exportAs = meta.exportAs, inputs = meta.inputs, outputs = meta.outputs, queries = meta.queries, providers = meta.providers;
    var mockMeta = { inputs: inputs, outputs: outputs, providers: providers, queries: queries };
    var mockParams = { exportAs: exportAs, selector: selector };
    var options = (0, decorate_declaration_1.default)(directive, mock, mockMeta, mockParams);
    (0, core_1.Directive)(options)(mock);
};
function MockDirectives() {
    var directives = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        directives[_i] = arguments[_i];
    }
    return directives.map(MockDirective);
}
exports.MockDirectives = MockDirectives;
/**
 * @see https://ng-mocks.sudo.eu/api/MockDirective
 */
function MockDirective(directive) {
    (0, func_import_exists_1.default)(directive, 'MockDirective');
    if ((0, func_is_mock_ng_def_1.isMockNgDef)(directive, 'd')) {
        return directive;
    }
    // We are inside of an 'it'.
    // It is fine to to return a mock copy or to throw an exception if it was not replaced with its mock copy in TestBed.
    if ((0, testing_1.getTestBed)()._instantiated) {
        try {
            return (0, func_get_mocked_ng_def_of_1.getMockedNgDefOf)(directive, 'd');
        }
        catch (error) {
            // looks like an in-test mock.
        }
    }
    if (ng_mocks_universe_1.default.flags.has('cacheDirective') && ng_mocks_universe_1.default.cacheDeclarations.has(directive)) {
        return ng_mocks_universe_1.default.cacheDeclarations.get(directive);
    }
    var mock = (0, core_helpers_1.extendClass)(DirectiveMockBase);
    decorateClass(directive, mock);
    // istanbul ignore else
    if (ng_mocks_universe_1.default.flags.has('cacheDirective')) {
        ng_mocks_universe_1.default.cacheDeclarations.set(directive, mock);
    }
    return mock;
}
exports.MockDirective = MockDirective;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9jay1kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL25nLW1vY2tzL3NyYy9saWIvbW9jay1kaXJlY3RpdmUvbW9jay1kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzQ0FVdUI7QUFDdkIsaURBQW1EO0FBRW5ELHdGQUFnRTtBQUNoRSxrRUFBMkM7QUFDM0MsdURBQXFEO0FBQ3JELDRHQUFtRjtBQUVuRixpRkFBdUU7QUFDdkUsb0ZBQTREO0FBQzVELHFFQUE0RDtBQUM1RCxxRkFBbUY7QUFDbkYsa0ZBQTBEO0FBQzFELHNGQUErRDtBQUkvRDtJQUFnQyxxQ0FBMEI7SUFDeEQsdUJBQXVCO0lBQ3ZCLDJCQUNFLFFBQWtCLEVBQ2xCLFNBQWMsRUFBRSxZQUFZO0lBQzVCLEdBQXNCLEVBQ3RCLEdBQXFCLEVBQ3JCLE9BQWlDLEVBQ2pDLFFBQXdDO1FBRHhDLHdCQUFBLEVBQUEsY0FBaUM7UUFDakMseUJBQUEsRUFBQSxlQUF3QztRQU4xQyxZQVFFLGtCQUFNLFFBQVEsRUFBRSxTQUFTLENBQUMsU0FFM0I7UUFEQyxLQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7O0lBQ3JELENBQUM7SUFFTSxvQ0FBUSxHQUFmO1FBQ0UsSUFBTSxNQUFNLEdBQUksSUFBSSxDQUFDLGVBQXVCLENBQUMsTUFBTSxDQUFDO1FBQ3BELElBQUksTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLE1BQU0sRUFBRTtZQUNaLElBQUEsS0FDSixNQUFNLENBQUMsTUFBTSxLQUFLLElBQUk7Z0JBQ3BCLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTTtnQkFDZixDQUFDLENBQUM7b0JBQ0UsU0FBUyxFQUFFLFNBQVM7b0JBQ3BCLFNBQVMsRUFBRSxFQUFFO2lCQUNk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QUFJLENBQUMsQ0FBQztLQUN4RDtJQUVELE9BQU8sSUFBVyxDQUFDO0FBQ3JCLENBQUM7QUE3QkQsc0NBNkJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgSW5qZWN0b3IsXG4gIE9uSW5pdCxcbiAgT3B0aW9uYWwsXG4gIFNlbGYsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q29udGFpbmVyUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGdldFRlc3RCZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuXG5pbXBvcnQgY29yZURlZmluZVByb3BlcnR5IGZyb20gJy4uL2NvbW1vbi9jb3JlLmRlZmluZS1wcm9wZXJ0eSc7XG5pbXBvcnQgY29yZUZvcm0gZnJvbSAnLi4vY29tbW9uL2NvcmUuZm9ybSc7XG5pbXBvcnQgeyBleHRlbmRDbGFzcyB9IGZyb20gJy4uL2NvbW1vbi9jb3JlLmhlbHBlcnMnO1xuaW1wb3J0IGNvcmVSZWZsZWN0RGlyZWN0aXZlUmVzb2x2ZSBmcm9tICcuLi9jb21tb24vY29yZS5yZWZsZWN0LmRpcmVjdGl2ZS1yZXNvbHZlJztcbmltcG9ydCB7IFR5cGUgfSBmcm9tICcuLi9jb21tb24vY29yZS50eXBlcyc7XG5pbXBvcnQgeyBnZXRNb2NrZWROZ0RlZk9mIH0gZnJvbSAnLi4vY29tbW9uL2Z1bmMuZ2V0LW1vY2tlZC1uZy1kZWYtb2YnO1xuaW1wb3J0IGZ1bmNJbXBvcnRFeGlzdHMgZnJvbSAnLi4vY29tbW9uL2Z1bmMuaW1wb3J0LWV4aXN0cyc7XG5pbXBvcnQgeyBpc01vY2tOZ0RlZiB9IGZyb20gJy4uL2NvbW1vbi9mdW5jLmlzLW1vY2stbmctZGVmJztcbmltcG9ydCB7IExlZ2FjeUNvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnLi4vY29tbW9uL21vY2stY29udHJvbC12YWx1ZS1hY2Nlc3Nvcic7XG5pbXBvcnQgbmdNb2Nrc1VuaXZlcnNlIGZyb20gJy4uL2NvbW1vbi9uZy1tb2Nrcy11bml2ZXJzZSc7XG5pbXBvcnQgZGVjb3JhdGVEZWNsYXJhdGlvbiBmcm9tICcuLi9tb2NrL2RlY29yYXRlLWRlY2xhcmF0aW9uJztcblxuaW1wb3J0IHsgTW9ja2VkRGlyZWN0aXZlIH0gZnJvbSAnLi90eXBlcyc7XG5cbmNsYXNzIERpcmVjdGl2ZU1vY2tCYXNlIGV4dGVuZHMgTGVnYWN5Q29udHJvbFZhbHVlQWNjZXNzb3IgaW1wbGVtZW50cyBPbkluaXQge1xuICAvLyBpc3RhbmJ1bCBpZ25vcmUgbmV4dFxuICBwdWJsaWMgY29uc3RydWN0b3IoXG4gICAgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIG5nQ29udHJvbDogYW55LCAvLyBOZ0NvbnRyb2xcbiAgICBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHZjcjogVmlld0NvbnRhaW5lclJlZixcbiAgICBlbGVtZW50OiBFbGVtZW50UmVmIHwgbnVsbCA9IG51bGwsXG4gICAgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4gfCBudWxsID0gbnVsbCxcbiAgKSB7XG4gICAgc3VwZXIoaW5qZWN0b3IsIG5nQ29udHJvbCk7XG4gICAgdGhpcy5fX25nTW9ja3NJbnN0YWxsKHZjciwgY2RyLCBlbGVtZW50LCB0ZW1wbGF0ZSk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgY29uZmlnID0gKHRoaXMuX19uZ01vY2tzQ29uZmlnIGFzIGFueSkuY29uZmlnO1xuICAgIGlmIChjb25maWc/LnJlbmRlcikge1xuICAgICAgY29uc3QgeyAkaW1wbGljaXQsIHZhcmlhYmxlcyB9ID1cbiAgICAgICAgY29uZmlnLnJlbmRlciAhPT0gdHJ1ZVxuICAgICAgICAgID8gY29uZmlnLnJlbmRlclxuICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAkaW1wbGljaXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgdmFyaWFibGVzOiB7fSxcbiAgICAgICAgICAgIH07XG4gICAgICAodGhpcyBhcyBhbnkpLl9fcmVuZGVyKCRpbXBsaWNpdCwgdmFyaWFibGVzKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9fbmdNb2Nrc0luc3RhbGwoXG4gICAgdmNyOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgZWxlbWVudDogRWxlbWVudFJlZiB8IG51bGwsXG4gICAgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4gfCBudWxsLFxuICApOiB2b2lkIHtcbiAgICAvLyBCYXNpY2FsbHkgYW55IGRpcmVjdGl2ZSBvbiBuZy10ZW1wbGF0ZSBpcyB0cmVhdGVkIGFzIHN0cnVjdHVyYWwsIGV2ZW4gaXQgZG9lcyBub3QgY29udHJvbCByZW5kZXIgcHJvY2Vzcy5cbiAgICAvLyBJbiBvdXIgY2FzZSB3ZSBkbyBub3QgaWYgd2Ugc2hvdWxkIHJlbmRlciBpdCBvciBub3QgYW5kIGR1ZSB0byB0aGlzIHdlIGRvIG5vdGhpbmcuXG4gICAgY29yZURlZmluZVByb3BlcnR5KHRoaXMsICdfX2VsZW1lbnQnLCBlbGVtZW50KTtcbiAgICBjb3JlRGVmaW5lUHJvcGVydHkodGhpcywgJ19fdGVtcGxhdGUnLCB0ZW1wbGF0ZSk7XG4gICAgY29yZURlZmluZVByb3BlcnR5KHRoaXMsICdfX3ZpZXdDb250YWluZXInLCB2Y3IpO1xuICAgIGNvcmVEZWZpbmVQcm9wZXJ0eSh0aGlzLCAnX192Y3InLCB2Y3IpO1xuICAgIGNvcmVEZWZpbmVQcm9wZXJ0eSh0aGlzLCAnX19jZHInLCBjZHIpO1xuICAgIGNvcmVEZWZpbmVQcm9wZXJ0eSh0aGlzLCAnX19pc1N0cnVjdHVyYWwnLCB0ZW1wbGF0ZSAmJiB2Y3IpO1xuXG4gICAgLy8gUHJvdmlkaW5nIG1ldGhvZCB0byByZW5kZXIgbW9jayB2YWx1ZXMuXG4gICAgY29yZURlZmluZVByb3BlcnR5KHRoaXMsICdfX3JlbmRlcicsICgkaW1wbGljaXQ/OiBhbnksIHZhcmlhYmxlcz86IFJlY29yZDxrZXlvZiBhbnksIGFueT4pID0+IHtcbiAgICAgIGlmICh2Y3IgJiYgdGVtcGxhdGUpIHtcbiAgICAgICAgdmNyLmNsZWFyKCk7XG4gICAgICAgIHZjci5jcmVhdGVFbWJlZGRlZFZpZXcodGVtcGxhdGUsIHsgLi4udmFyaWFibGVzLCAkaW1wbGljaXQgfSk7XG4gICAgICAgIGNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuY29yZURlZmluZVByb3BlcnR5KERpcmVjdGl2ZU1vY2tCYXNlLCAncGFyYW1ldGVycycsIFtcbiAgW0luamVjdG9yXSxcbiAgW2NvcmVGb3JtLk5nQ29udHJvbCB8fCAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyAoKCkgPT4gdW5kZWZpbmVkKSwgbmV3IE9wdGlvbmFsKCksIG5ldyBTZWxmKCldLFxuICBbQ2hhbmdlRGV0ZWN0b3JSZWZdLFxuICBbVmlld0NvbnRhaW5lclJlZl0sXG4gIFtFbGVtZW50UmVmLCBuZXcgT3B0aW9uYWwoKSwgbmV3IFNlbGYoKV0sXG4gIFtUZW1wbGF0ZVJlZiwgbmV3IE9wdGlvbmFsKCksIG5ldyBTZWxmKCldLFxuXSk7XG5cbmNvbnN0IGRlY29yYXRlQ2xhc3MgPSAoZGlyZWN0aXZlOiBUeXBlPGFueT4sIG1vY2s6IFR5cGU8YW55Pik6IHZvaWQgPT4ge1xuICBjb25zdCBtZXRhID0gY29yZVJlZmxlY3REaXJlY3RpdmVSZXNvbHZlKGRpcmVjdGl2ZSk7XG4gIGNvbnN0IHsgc2VsZWN0b3IsIGV4cG9ydEFzLCBpbnB1dHMsIG91dHB1dHMsIHF1ZXJpZXMsIHByb3ZpZGVycyB9ID0gbWV0YTtcbiAgY29uc3QgbW9ja01ldGEgPSB7IGlucHV0cywgb3V0cHV0cywgcHJvdmlkZXJzLCBxdWVyaWVzIH07XG4gIGNvbnN0IG1vY2tQYXJhbXMgPSB7IGV4cG9ydEFzLCBzZWxlY3RvciB9O1xuICBjb25zdCBvcHRpb25zID0gZGVjb3JhdGVEZWNsYXJhdGlvbihkaXJlY3RpdmUsIG1vY2ssIG1vY2tNZXRhLCBtb2NrUGFyYW1zKTtcbiAgRGlyZWN0aXZlKG9wdGlvbnMpKG1vY2spO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIE1vY2tEaXJlY3RpdmVzKC4uLmRpcmVjdGl2ZXM6IEFycmF5PFR5cGU8YW55Pj4pOiBBcnJheTxUeXBlPE1vY2tlZERpcmVjdGl2ZTxhbnk+Pj4ge1xuICByZXR1cm4gZGlyZWN0aXZlcy5tYXAoTW9ja0RpcmVjdGl2ZSk7XG59XG5cbi8qKlxuICogQHNlZSBodHRwczovL25nLW1vY2tzLnN1ZG8uZXUvYXBpL01vY2tEaXJlY3RpdmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIE1vY2tEaXJlY3RpdmU8VERpcmVjdGl2ZT4oZGlyZWN0aXZlOiBUeXBlPFREaXJlY3RpdmU+KTogVHlwZTxNb2NrZWREaXJlY3RpdmU8VERpcmVjdGl2ZT4+IHtcbiAgZnVuY0ltcG9ydEV4aXN0cyhkaXJlY3RpdmUsICdNb2NrRGlyZWN0aXZlJyk7XG5cbiAgaWYgKGlzTW9ja05nRGVmKGRpcmVjdGl2ZSwgJ2QnKSkge1xuICAgIHJldHVybiBkaXJlY3RpdmU7XG4gIH1cblxuICAvLyBXZSBhcmUgaW5zaWRlIG9mIGFuICdpdCcuXG4gIC8vIEl0IGlzIGZpbmUgdG8gdG8gcmV0dXJuIGEgbW9jayBjb3B5IG9yIHRvIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBpdCB3YXMgbm90IHJlcGxhY2VkIHdpdGggaXRzIG1vY2sgY29weSBpbiBUZXN0QmVkLlxuICBpZiAoKGdldFRlc3RCZWQoKSBhcyBhbnkpLl9pbnN0YW50aWF0ZWQpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGdldE1vY2tlZE5nRGVmT2YoZGlyZWN0aXZlLCAnZCcpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBsb29rcyBsaWtlIGFuIGluLXRlc3QgbW9jay5cbiAgICB9XG4gIH1cbiAgaWYgKG5nTW9ja3NVbml2ZXJzZS5mbGFncy5oYXMoJ2NhY2hlRGlyZWN0aXZlJykgJiYgbmdNb2Nrc1VuaXZlcnNlLmNhY2hlRGVjbGFyYXRpb25zLmhhcyhkaXJlY3RpdmUpKSB7XG4gICAgcmV0dXJuIG5nTW9ja3NVbml2ZXJzZS5jYWNoZURlY2xhcmF0aW9ucy5nZXQoZGlyZWN0aXZlKTtcbiAgfVxuXG4gIGNvbnN0IG1vY2sgPSBleHRlbmRDbGFzcyhEaXJlY3RpdmVNb2NrQmFzZSk7XG4gIGRlY29yYXRlQ2xhc3MoZGlyZWN0aXZlLCBtb2NrKTtcblxuICAvLyBpc3RhbmJ1bCBpZ25vcmUgZWxzZVxuICBpZiAobmdNb2Nrc1VuaXZlcnNlLmZsYWdzLmhhcygnY2FjaGVEaXJlY3RpdmUnKSkge1xuICAgIG5nTW9ja3NVbml2ZXJzZS5jYWNoZURlY2xhcmF0aW9ucy5zZXQoZGlyZWN0aXZlLCBtb2NrKTtcbiAgfVxuXG4gIHJldHVybiBtb2NrIGFzIGFueTtcbn1cbiJdfQ==