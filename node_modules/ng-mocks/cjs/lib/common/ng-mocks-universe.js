"use strict";
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_config_1 = __importDefault(require("./core.config"));
// istanbul ignore next
var getGlobal = function () { return window || global; };
var globalMap = function (key) { return function () {
    if (!ngMocksUniverse.global.has(key)) {
        ngMocksUniverse.global.set(key, new Map());
    }
    return ngMocksUniverse.global.get(key);
}; };
getGlobal().ngMocksUniverse = getGlobal().ngMocksUniverse || {};
var ngMocksUniverse = getGlobal().ngMocksUniverse;
ngMocksUniverse.builtDeclarations = new Map();
ngMocksUniverse.builtProviders = new Map();
ngMocksUniverse.cacheDeclarations = new Map();
ngMocksUniverse.cacheProviders = new Map();
ngMocksUniverse.config = new Map();
ngMocksUniverse.configInstance = new Map();
ngMocksUniverse.flags = new Set(core_config_1.default.flags);
ngMocksUniverse.global = new Map();
ngMocksUniverse.touches = new Set();
ngMocksUniverse.global.set('flags', {
    // @deprecated and will be changed in A13 to 'throw'
    onMockInstanceRestoreNeed: core_config_1.default.onMockInstanceRestoreNeed,
    // @deprecated and will be changed in A13 to 'throw'
    onTestBedFlushNeed: core_config_1.default.onTestBedFlushNeed,
});
ngMocksUniverse.getLocalMocks = function () {
    if (!ngMocksUniverse.global.has('local-mocks')) {
        ngMocksUniverse.global.set('local-mocks', []);
    }
    return ngMocksUniverse.global.get('local-mocks');
};
ngMocksUniverse.getOverrides = globalMap('overrides');
ngMocksUniverse.getDefaults = globalMap('defaults');
var getDefaults = function (def) {
    {
        var defValue = ngMocksUniverse.getDefaults().get(def);
        if (defValue) {
            return defValue;
        }
    }
    {
        var defValue = typeof def === 'function' ? ngMocksUniverse.getDefaults().get("@" + def.name) : undefined;
        if (defValue) {
            return defValue;
        }
    }
    return [];
};
ngMocksUniverse.getResolution = function (def) {
    var set = ngMocksUniverse.config.get('ngMocksDepsResolution');
    if (set === null || set === void 0 ? void 0 : set.has(def)) {
        return set.get(def);
    }
    var _a = __read(getDefaults(def), 1), value = _a[0];
    return value;
};
ngMocksUniverse.getBuildDeclaration = function (def) {
    if (ngMocksUniverse.builtDeclarations.has(def)) {
        return ngMocksUniverse.builtDeclarations.get(def);
    }
    var _a = __read(getDefaults(def), 2), mode = _a[0], replacement = _a[1];
    if (mode === 'exclude') {
        return null;
    }
    if (mode === 'keep') {
        return def;
    }
    if (mode === 'replace') {
        return replacement;
    }
};
ngMocksUniverse.hasBuildDeclaration = function (def) {
    if (ngMocksUniverse.builtDeclarations.has(def)) {
        return true;
    }
    var _a = __read(getDefaults(def), 1), mode = _a[0];
    return !!mode && mode !== 'mock';
};
var hasBuildDeclaration = function (def) { return ngMocksUniverse.hasBuildDeclaration(def); };
var getBuildDeclaration = function (def) { return ngMocksUniverse.getBuildDeclaration(def); };
ngMocksUniverse.isExcludedDef = function (def) {
    var resolution = ngMocksUniverse.getResolution(def);
    if (resolution && resolution !== 'exclude') {
        return false;
    }
    return hasBuildDeclaration(def) && getBuildDeclaration(def) === null;
};
ngMocksUniverse.isProvidedDef = function (def) { return hasBuildDeclaration(def) && getBuildDeclaration(def) !== null; };
// excluding StoreDevtoolsModule by default
ngMocksUniverse.getDefaults().set('@StoreDevtoolsModule', ['exclude']);
exports.default = (function () { return ngMocksUniverse; })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctbW9ja3MtdW5pdmVyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL25nLW1vY2tzL3NyYy9saWIvY29tbW9uL25nLW1vY2tzLXVuaXZlcnNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLDhEQUF1QztBQUd2Qyx1QkFBdUI7QUFDdkIsSUFBTSxTQUFTLEdBQUcsY0FBVyxPQUFBLE1BQU0sSUFBSSxNQUFNLEVBQWhCLENBQWdCLENBQUM7QUFFOUMsSUFBTSxTQUFTLEdBQUcsVUFBQyxHQUFXLElBQUssT0FBQTtJQUNqQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDcEMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQztLQUM1QztJQUVELE9BQU8sZUFBZSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDekMsQ0FBQyxFQU5rQyxDQU1sQyxDQUFDO0FBc0JGLFNBQVMsRUFBRSxDQUFDLGVBQWUsR0FBRyxTQUFTLEVBQUUsQ0FBQyxlQUFlLElBQUksRUFBRSxDQUFDO0FBQ2hFLElBQU0sZUFBZSxHQUFvQixTQUFTLEVBQUUsQ0FBQyxlQUFlLENBQUM7QUFFckUsZUFBZSxDQUFDLGlCQUFpQixHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7QUFDOUMsZUFBZSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQzNDLGVBQWUsQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQzlDLGVBQWUsQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztBQUMzQyxlQUFlLENBQUMsTUFBTSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7QUFDbkMsZUFBZSxDQUFDLGNB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QUFDLENBQUMsQ0FBQztBQUV2RSxrQkFBZSxDQUFDLGNBQXVCLE9BQUEsZUFBZSxFQUFmLENBQWUsQ0FBQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3Rpb25Ub2tlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgY29yZUNvbmZpZyBmcm9tICcuL2NvcmUuY29uZmlnJztcbmltcG9ydCB7IEFueVR5cGUgfSBmcm9tICcuL2NvcmUudHlwZXMnO1xuXG4vLyBpc3RhbmJ1bCBpZ25vcmUgbmV4dFxuY29uc3QgZ2V0R2xvYmFsID0gKCk6IGFueSA9PiB3aW5kb3cgfHwgZ2xvYmFsO1xuXG5jb25zdCBnbG9iYWxNYXAgPSAoa2V5OiBzdHJpbmcpID0+ICgpID0+IHtcbiAgaWYgKCFuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLmhhcyhrZXkpKSB7XG4gICAgbmdNb2Nrc1VuaXZlcnNlLmdsb2JhbC5zZXQoa2V5LCBuZXcgTWFwKCkpO1xuICB9XG5cbiAgcmV0dXJuIG5nTW9ja3NVbml2ZXJzZS5nbG9iYWwuZ2V0KGtleSk7XG59O1xuXG5pbnRlcmZhY2UgTmdNb2Nrc1VuaXZlcnNlIHtcbiAgYnVpbHREZWNsYXJhdGlvbnM6IE1hcDxhbnksIGFueT47XG4gIGJ1aWx0UHJvdmlkZXJzOiBNYXA8YW55LCBhbnk+O1xuICBjYWNoZURlY2xhcmF0aW9uczogTWFwPGFueSwgYW55PjtcbiAgY2FjaGVQcm92aWRlcnM6IE1hcDxhbnksIGFueT47XG4gIGNvbmZpZzogTWFwPGFueSwgYW55PjtcbiAgY29uZmlnSW5zdGFuY2U6IE1hcDxhbnksIGFueT47XG4gIGZsYWdzOiBTZXQ8c3RyaW5nPjtcbiAgZ2V0QnVpbGREZWNsYXJhdGlvbjogKGRlZjogYW55KSA9PiBhbnkgfCB1bmRlZmluZWQ7XG4gIGdldERlZmF1bHRzOiAoKSA9PiBNYXA8YW55LCBbJ21vY2snIHwgJ2tlZXAnIHwgJ3JlcGxhY2UnIHwgJ2V4Y2x1ZGUnLCBhbnk/XT47XG4gIGdldExvY2FsTW9ja3M6ICgpID0+IEFycmF5PFthbnksIGFueV0+O1xuICBnZXRPdmVycmlkZXM6ICgpID0+IE1hcDxhbnksIGFueT47XG4gIGdldFJlc29sdXRpb246IChkZWY6IGFueSkgPT4gdW5kZWZpbmVkIHwgJ21vY2snIHwgJ2tlZXAnIHwgJ3JlcGxhY2UnIHwgJ2V4Y2x1ZGUnO1xuICBnbG9iYWw6IE1hcDxhbnksIGFueT47XG4gIGhhc0J1aWxkRGVjbGFyYXRpb246IChkZWY6IGFueSkgPT4gYm9vbGVhbjtcbiAgaXNFeGNsdWRlZERlZjogKGRlZjogYW55KSA9PiBib29sZWFuO1xuICBpc1Byb3ZpZGVkRGVmOiAoZGVmOiBhbnkpID0+IGJvb2xlYW47XG4gIHRvdWNoZXM6IFNldDxBbnlUeXBlPGFueT4gfCBJbmplY3Rpb25Ub2tlbjxhbnk+IHwgc3RyaW5nPjtcbn1cblxuZ2V0R2xvYmFsKCkubmdNb2Nrc1VuaXZlcnNlID0gZ2V0R2xvYmFsKCkubmdNb2Nrc1VuaXZlcnNlIHx8IHt9O1xuY29uc3QgbmdNb2Nrc1VuaXZlcnNlOiBOZ01vY2tzVW5pdmVyc2UgPSBnZXRHbG9iYWwoKS5uZ01vY2tzVW5pdmVyc2U7XG5cbm5nTW9ja3NVbml2ZXJzZS5idWlsdERlY2xhcmF0aW9ucyA9IG5ldyBNYXAoKTtcbm5nTW9ja3NVbml2ZXJzZS5idWlsdFByb3ZpZGVycyA9IG5ldyBNYXAoKTtcbm5nTW9ja3NVbml2ZXJzZS5jYWNoZURlY2xhcmF0aW9ucyA9IG5ldyBNYXAoKTtcbm5nTW9ja3NVbml2ZXJzZS5jYWNoZVByb3ZpZGVycyA9IG5ldyBNYXAoKTtcbm5nTW9ja3NVbml2ZXJzZS5jb25maWcgPSBuZXcgTWFwKCk7XG5uZ01vY2tzVW5pdmVyc2UuY29uZmlnSW5zdGFuY2UgPSBuZXcgTWFwKCk7XG5uZ01vY2tzVW5pdmVyc2UuZmxhZ3MgPSBuZXcgU2V0KGNvcmVDb25maWcuZmxhZ3MpO1xubmdNb2Nrc1VuaXZlcnNlLmdsb2JhbCA9IG5ldyBNYXAoKTtcbm5nTW9ja3NVbml2ZXJzZS50b3VjaGVzID0gbmV3IFNldCgpO1xuXG5uZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLnNldCgnZmxhZ3MnLCB7XG4gIC8vIEBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIGNoYW5nZWQgaW4gQTEzIHRvICd0aHJvdydcbiAgb25Nb2NrSW5zdGFuY2VSZXN0b3JlTmVlZDogY29yZUNvbmZpZy5vbk1vY2tJbnN0YW5jZVJlc3RvcmVOZWVkLFxuICAvLyBAZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSBjaGFuZ2VkIGluIEExMyB0byAndGhyb3cnXG4gIG9uVGVzdEJlZEZsdXNoTmVlZDogY29yZUNvbmZpZy5vblRlc3RCZWRGbHVzaE5lZWQsXG59KTtcblxubmdNb2Nrc1VuaXZlcnNlLmdldExvY2FsTW9ja3MgPSAoKSA9PiB7XG4gIGlmICghbmdNb2Nrc1VuaXZlcnNlLmdsb2JhbC5oYXMoJ2xvY2FsLW1vY2tzJykpIHtcbiAgICBuZ01vY2tzVW5pdmVyc2UuZ2xvYmFsLnNldCgnbG9jYWwtbW9ja3MnLCBbXSk7XG4gIH1cblxuICByZXR1cm4gbmdNb2Nrc1VuaXZlcnNlLmdsb2JhbC5nZXQoJ2xvY2FsLW1vY2tzJyk7XG59O1xuXG5uZ01vY2tzVW5pdmVyc2UuZ2V0T3ZlcnJpZGVzID0gZ2xvYmFsTWFwKCdvdmVycmlkZXMnKTtcbm5nTW9ja3NVbml2ZXJzZS5nZXREZWZhdWx0cyA9IGdsb2JhbE1hcCgnZGVmYXVsdHMnKTtcblxuY29uc3QgZ2V0RGVmYXVsdHMgPSAoZGVmOiBhbnkpOiBbXSB8IFsnbW9jaycgfCAna2VlcCcgfCAncmVwbGFjZScgfCAnZXhjbHVkZScsIGFueT9dID0+IHtcbiAge1xuICAgIGNvbnN0IGRlZlZhbHVlID0gbmdNb2Nrc1VuaXZlcnNlLmdldERlZmF1bHRzKCkuZ2V0KGRlZik7XG4gICAgaWYgKGRlZlZhbHVlKSB7XG4gICAgICByZXR1cm4gZGVmVmFsdWU7XG4gICAgfVxuICB9XG5cbiAge1xuICAgIGNvbnN0IGRlZlZhbHVlID0gdHlwZW9mIGRlZiA9PT0gJ2Z1bmN0aW9uJyA/IG5nTW9ja3NVbml2ZXJzZS5nZXREZWZhdWx0cygpLmdldChgQCR7ZGVmLm5hbWV9YCkgOiB1bmRlZmluZWQ7XG4gICAgaWYgKGRlZlZhbHVlKSB7XG4gICAgICByZXR1cm4gZGVmVmFsdWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIFtdO1xufTtcblxubmdNb2Nrc1VuaXZlcnNlLmdldFJlc29sdXRpb24gPSAoZGVmOiBhbnkpOiB1bmRlZmluZWQgfCAnbW9jaycgfCAna2VlcCcgfCAncmVwbGFjZScgfCAnZXhjbHVkZScgPT4ge1xuICBjb25zdCBzZXQgPSBuZ01vY2tzVW5pdmVyc2UuY29uZmlnLmdldCgnbmdNb2Nrc0RlcHNSZXNvbHV0aW9uJyk7XG4gIGlmIChzZXQ/LmhhcyhkZWYpKSB7XG4gICAgcmV0dXJuIHNldC5nZXQoZGVmKTtcbiAgfVxuICBjb25zdCBbdmFsdWVdID0gZ2V0RGVmYXVsdHMoZGVmKTtcblxuICByZXR1cm4gdmFsdWU7XG59O1xuXG5uZ01vY2tzVW5pdmVyc2UuZ2V0QnVpbGREZWNsYXJhdGlvbiA9IChkZWY6IGFueSk6IHVuZGVmaW5lZCB8IG51bGwgfCBhbnkgPT4ge1xuICBpZiAobmdNb2Nrc1VuaXZlcnNlLmJ1aWx0RGVjbGFyYXRpb25zLmhhcyhkZWYpKSB7XG4gICAgcmV0dXJuIG5nTW9ja3NVbml2ZXJzZS5idWlsdERlY2xhcmF0aW9ucy5nZXQoZGVmKTtcbiAgfVxuICBjb25zdCBbbW9kZSwgcmVwbGFjZW1lbnRdID0gZ2V0RGVmYXVsdHMoZGVmKTtcblxuICBpZiAobW9kZSA9PT0gJ2V4Y2x1ZGUnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgaWYgKG1vZGUgPT09ICdrZWVwJykge1xuICAgIHJldHVybiBkZWY7XG4gIH1cbiAgaWYgKG1vZGUgPT09ICdyZXBsYWNlJykge1xuICAgIHJldHVybiByZXBsYWNlbWVudDtcbiAgfVxufTtcblxubmdNb2Nrc1VuaXZlcnNlLmhhc0J1aWxkRGVjbGFyYXRpb24gPSAoZGVmOiBhbnkpOiBib29sZWFuID0+IHtcbiAgaWYgKG5nTW9ja3NVbml2ZXJzZS5idWlsdERlY2xhcmF0aW9ucy5oYXMoZGVmKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IFttb2RlXSA9IGdldERlZmF1bHRzKGRlZik7XG5cbiAgcmV0dXJuICEhbW9kZSAmJiBtb2RlICE9PSAnbW9jayc7XG59O1xuXG5jb25zdCBoYXNCdWlsZERlY2xhcmF0aW9uID0gKGRlZjogYW55KTogYm9vbGVhbiA9PiBuZ01vY2tzVW5pdmVyc2UuaGFzQnVpbGREZWNsYXJhdGlvbihkZWYpO1xuY29uc3QgZ2V0QnVpbGREZWNsYXJhdGlvbiA9IChkZWY6IGFueSk6IGFueSA9PiBuZ01vY2tzVW5pdmVyc2UuZ2V0QnVpbGREZWNsYXJhdGlvbihkZWYpO1xuXG5uZ01vY2tzVW5pdmVyc2UuaXNFeGNsdWRlZERlZiA9IChkZWY6IGFueSk6IGJvb2xlYW4gPT4ge1xuICBjb25zdCByZXNvbHV0aW9uID0gbmdNb2Nrc1VuaXZlcnNlLmdldFJlc29sdXRpb24oZGVmKTtcbiAgaWYgKHJlc29sdXRpb24gJiYgcmVzb2x1dGlvbiAhPT0gJ2V4Y2x1ZGUnKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGhhc0J1aWxkRGVjbGFyYXRpb24oZGVmKSAmJiBnZXRCdWlsZERlY2xhcmF0aW9uKGRlZikgPT09IG51bGw7XG59O1xuXG5uZ01vY2tzVW5pdmVyc2UuaXNQcm92aWRlZERlZiA9IChkZWY6IGFueSk6IGJvb2xlYW4gPT4gaGFzQnVpbGREZWNsYXJhdGlvbihkZWYpICYmIGdldEJ1aWxkRGVjbGFyYXRpb24oZGVmKSAhPT0gbnVsbDtcblxuLy8gZXhjbHVkaW5nIFN0b3JlRGV2dG9vbHNNb2R1bGUgYnkgZGVmYXVsdFxubmdNb2Nrc1VuaXZlcnNlLmdldERlZmF1bHRzKCkuc2V0KCdAU3RvcmVEZXZ0b29sc01vZHVsZScsIFsnZXhjbHVkZSddKTtcblxuZXhwb3J0IGRlZmF1bHQgKCgpOiBOZ01vY2tzVW5pdmVyc2UgPT4gbmdNb2Nrc1VuaXZlcnNlKSgpO1xuIl19