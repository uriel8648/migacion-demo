{"version":3,"file":"router-upgrade.umd.js","sources":["../../../../../packages/router/upgrade/src/upgrade.ts","../../../../../packages/router/upgrade/public_api.ts","../../../../../packages/router/upgrade/index.ts","../../../../../packages/router/upgrade/upgrade.ts"],"names":["APP_BOOTSTRAP_LISTENER","UpgradeModule","router","Router","Location"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Location} from '@angular/common';\nimport {APP_BOOTSTRAP_LISTENER, ComponentRef, InjectionToken} from '@angular/core';\nimport {Router} from '@angular/router';\nimport {UpgradeModule} from '@angular/upgrade/static';\n\n/**\n * Creates an initializer that sets up `ngRoute` integration\n * along with setting up the Angular router.\n *\n * @usageNotes\n *\n * <code-example language=\"typescript\">\n * @NgModule({\n *  imports: [\n *   RouterModule.forRoot(SOME_ROUTES),\n *   UpgradeModule\n * ],\n * providers: [\n *   RouterUpgradeInitializer\n * ]\n * })\n * export class AppModule {\n *   ngDoBootstrap() {}\n * }\n * </code-example>\n *\n * @publicApi\n */\nexport const RouterUpgradeInitializer = {\n  provide: APP_BOOTSTRAP_LISTENER,\n  multi: true,\n  useFactory: locationSyncBootstrapListener as (ngUpgrade: UpgradeModule) => () => void,\n  deps: [UpgradeModule]\n};\n\n/**\n * @internal\n */\nexport function locationSyncBootstrapListener(ngUpgrade: UpgradeModule) {\n  return () => {\n    setUpLocationSync(ngUpgrade);\n  };\n}\n\n/**\n * Sets up a location change listener to trigger `history.pushState`.\n * Works around the problem that `onPopState` does not trigger `history.pushState`.\n * Must be called *after* calling `UpgradeModule.bootstrap`.\n *\n * @param ngUpgrade The upgrade NgModule.\n * @param urlType The location strategy.\n * @see `HashLocationStrategy`\n * @see `PathLocationStrategy`\n *\n * @publicApi\n */\nexport function setUpLocationSync(ngUpgrade: UpgradeModule, urlType: 'path'|'hash' = 'path') {\n  if (!ngUpgrade.$injector) {\n    throw new Error(`\n        RouterUpgradeInitializer can be used only after UpgradeModule.bootstrap has been called.\n        Remove RouterUpgradeInitializer and call setUpLocationSync after UpgradeModule.bootstrap.\n      `);\n  }\n\n  const router: Router = ngUpgrade.injector.get(Router);\n  const location: Location = ngUpgrade.injector.get(Location);\n\n  ngUpgrade.$injector.get('$rootScope')\n      .$on('$locationChangeStart', (_: any, next: string, __: string) => {\n        let url;\n        if (urlType === 'path') {\n          url = resolveUrl(next);\n        } else if (urlType === 'hash') {\n          // Remove the first hash from the URL\n          const hashIdx = next.indexOf('#');\n          url = resolveUrl(next.substring(0, hashIdx) + next.substring(hashIdx + 1));\n        } else {\n          throw 'Invalid URLType passed to setUpLocationSync: ' + urlType;\n        }\n        const path = location.normalize(url.pathname);\n        router.navigateByUrl(path + url.search + url.hash);\n      });\n}\n\n/**\n * Normalizes and parses a URL.\n *\n * - Normalizing means that a relative URL will be resolved into an absolute URL in the context of\n *   the application document.\n * - Parsing means that the anchor's `protocol`, `hostname`, `port`, `pathname` and related\n *   properties are all populated to reflect the normalized URL.\n *\n * While this approach has wide compatibility, it doesn't work as expected on IE. On IE, normalizing\n * happens similar to other browsers, but the parsed components will not be set. (E.g. if you assign\n * `a.href = 'foo'`, then `a.protocol`, `a.host`, etc. will not be correctly updated.)\n * We work around that by performing the parsing in a 2nd step by taking a previously normalized URL\n * and assigning it again. This correctly populates all properties.\n *\n * See\n * https://github.com/angular/angular.js/blob/2c7400e7d07b0f6cec1817dab40b9250ce8ebce6/src/ng/urlUtils.js#L26-L33\n * for more info.\n */\nlet anchor: HTMLAnchorElement|undefined;\nfunction resolveUrl(url: string): {pathname: string, search: string, hash: string} {\n  if (!anchor) {\n    anchor = document.createElement('a');\n  }\n\n  anchor.setAttribute('href', url);\n  anchor.setAttribute('href', anchor.href);\n\n  return {\n    // IE does not start `pathname` with `/` like other browsers.\n    pathname: `/${anchor.pathname.replace(/^\\//, '')}`,\n    search: anchor.search,\n    hash: anchor.hash\n  };\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n/**\n * @module\n * @description\n * Entry point for all public APIs of this package.\n */\nexport * from './src/upgrade';\n\n// This file only reexports content of the `src` folder. Keep it that way.\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n// This file is not used to build this module. It is only used during editing\n// by the TypeScript language service and during build for verification. `ngc`\n// replaces this file with production index.ts when it rewrites private symbol\n// names.\n\nexport * from './public_api';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"]}